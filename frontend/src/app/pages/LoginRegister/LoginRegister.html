<div class="login-layout">
  <main class="form-container">
    <div class="form-wrapper" [class.show-register]="currentView() === 'register'">

      <!-- HEADER -->
      <header class="header">
        <div class="logo-wrapper">
          <img ngSrc="logo_1_escudo_sin.png" width="50" height="60" alt="Logo" priority>
        </div>
        <h1 class="brand-name">OccultaShield</h1>
      </header>

      <!-- LOGIN FORM -->
      @if (currentView() === 'login') {
      <div class="form-content fade-in">
        <h2 class="headline">Secure Access Portal</h2>
        <p class="subheadline">Enter your credentials to access your secure dashboard.</p>

        <!-- GLOBAL ERROR ALERT -->
        @if (authService.error()) {
        <div class="alert alert-error fade-in">
          <span class="alert-icon">‚ö†Ô∏è</span>
          <span class="alert-message">{{ authService.error() }}</span>
        </div>
        }

        <form (submit)="onLoginSubmit($event)" class="login-form">
          <div class="input-group">
            <label for="email">Email address</label>
            <input id="email" type="email" [field]="loginForm.email" placeholder="name@company.com"
              autocomplete="email">
            @if (loginForm.email().touched() && loginForm.email().invalid()) {
            <ul class="error-list">
              @for (error of loginForm.email().errors(); track error) { <li class="error-text">{{ error.message }}</li>
              }
            </ul>
            }
          </div>

          <div class="input-group">
            <label for="password">Password</label>
            <div class="password-wrapper">
              <input [type]="showPassword() ? 'text' : 'password'" id="password" [field]="loginForm.password"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
              <button type="button" class="toggle-visibility" (click)="togglePasswordVisibility()">
                <!-- Reuse existing SVG logic -->
                @if (!showPassword()) {
                <span class="material-icons-outlined">visibility</span>
                } @else {
                <span class="material-icons-outlined">visibility_off</span>
                }
              </button>
            </div>
            @if (loginForm.password().touched() && loginForm.password().invalid()) {
            <ul class="error-list">@for (error of loginForm.password().errors(); track error) { <li class="error-text">
                {{ error.message }}</li> }</ul>
            }
          </div>

          <div class="actions-row">
            <label class="custom-checkbox">
              <input type="checkbox" [field]="loginForm.rememberMe">
              <span class="checkmark"></span>
              <span class="label-text">Remember me</span>
            </label>
            <a routerLink="/forgot-password" class="link-forgot">Forgot password?</a>
          </div>

          <div class="buttons-grid">
            <button type="button" class="btn btn-secondary" (click)="toggleAuthMode()">Create Account</button>
            <button type="submit" class="btn btn-primary" [disabled]="loginForm().invalid() || isLoading()">
              @if (isLoading()) { <span class="spinner"></span> Processing... } @else { Sign in }
            </button>
          </div>
        </form>
      </div>
      }

      <!-- REGISTER FORM -->
      @if (currentView() === 'register') {
      <div class="form-content fade-in">

        <!-- PENDING APPROVAL NOTIFICATION -->
        @if (registrationPending()) {
        <div class="pending-card fade-in">
          <div class="pending-icon">‚úì</div>
          <h2>¬°Registro Completado!</h2>
          <p>Tu cuenta est√° <strong>pendiente de aprobaci√≥n</strong>.</p>
          <p class="pending-details">
            Un administrador revisar√° tu solicitud en <strong>1-2 d√≠as</strong>.
            Recibir√°s un email cuando tu cuenta est√© activa.
          </p>
          <button type="button" class="btn btn-primary" (click)="toggleAuthMode()">
            Volver al Login
          </button>
        </div>
        } @else {

        <h2 class="headline">Create Account</h2>
        <p class="subheadline">Join OccultaShield for advanced privacy protection.</p>

        <!-- GLOBAL ERROR ALERT -->
        @if (authService.error()) {
        <div class="alert alert-error fade-in">
          <span class="alert-icon">‚ö†Ô∏è</span>
          <span class="alert-message">{{ authService.error() }}</span>
        </div>
        }

        <form (submit)="onRegisterSubmit($event)" class="login-form">

          <!-- Name -->
          <div class="input-group">
            <label for="reg-name">Full Name</label>
            <input id="reg-name" type="text" [field]="registerForm.nameSurname" placeholder="John Doe"
              autocomplete="name">
            @if (registerForm.nameSurname().touched() && registerForm.nameSurname().invalid()) {
            <ul class="error-list">@for (error of registerForm.nameSurname().errors(); track error) { <li
                class="error-text">{{ error.message }}</li> }</ul>
            }
          </div>

          <!-- Email -->
          <div class="input-group">
            <label for="reg-email">Email address</label>
            <input id="reg-email" type="email" [field]="registerForm.email" placeholder="name@company.com"
              autocomplete="email">
            @if (registerForm.email().touched() && registerForm.email().invalid()) {
            <ul class="error-list">@for (error of registerForm.email().errors(); track error) { <li class="error-text">
                {{ error.message }}</li> }</ul>
            }
          </div>

          <!-- Usage Type Selector -->
          <div class="input-group">
            <label>How will you use OccultaShield?</label>
            <div class="usage-selector">
              <button type="button" class="usage-option"
                [class.active]="registerCredentials().usageType === 'individual'" (click)="setUsageType('individual')">
                <span class="usage-icon">üë§</span>
                <span>Individual</span>
              </button>
              <button type="button" class="usage-option"
                [class.active]="registerCredentials().usageType === 'researcher'" (click)="setUsageType('researcher')">
                <span class="usage-icon">üî¨</span>
                <span>Researcher</span>
              </button>
              <button type="button" class="usage-option" [class.active]="registerCredentials().usageType === 'agency'"
                (click)="setUsageType('agency')">
                <span class="usage-icon">üè¢</span>
                <span>Agency</span>
              </button>
            </div>
          </div>

          <!-- Password with Strength Meter -->
          <div class="input-group">
            <label for="reg-pass">Password</label>
            <input [type]="showPassword() ? 'text' : 'password'" id="reg-pass" [field]="registerForm.password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">

            <!-- Password Strength Meter -->
            @if (registerCredentials().password) {
            <div class="strength-meter">
              <div class="strength-bar">
                <div class="strength-fill" [style.width.%]="passwordStrength().score * 25"
                  [style.background]="passwordStrength().color"></div>
              </div>
              <span class="strength-label" [style.color]="passwordStrength().color">
                {{ passwordStrength().label }}
              </span>
            </div>
            }

            @if (registerForm.password().touched() && registerForm.password().invalid()) {
            <ul class="error-list">@for (error of registerForm.password().errors(); track error) { <li
                class="error-text">{{ error.message }}</li> }</ul>
            }
          </div>

          <!-- Confirm Password -->
          <div class="input-group">
            <label for="reg-confirm-pass">Confirm Password</label>
            <input [type]="showPassword() ? 'text' : 'password'" id="reg-confirm-pass"
              [field]="registerForm.confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
            @if (registerForm.confirmPassword().touched() && registerForm.confirmPassword().invalid()) {
            <ul class="error-list">@for (error of registerForm.confirmPassword().errors(); track error) { <li
                class="error-text">{{ error.message }}</li> }</ul>
            }
          </div>

          <!-- Privacy Check -->
          <div class="actions-row">
            <label class="custom-checkbox">
              <input type="checkbox" [field]="registerForm.privacyCheck">
              <span class="checkmark"></span>
              <span class="label-text">I accept the Privacy Policy</span>
            </label>
          </div>

          <div class="buttons-grid">
            <button type="button" class="btn btn-secondary" (click)="toggleAuthMode()">Back to Login</button>
            <button type="submit" class="btn btn-primary" [disabled]="registerForm().invalid() || isLoading()">
              @if (isLoading()) { <span class="spinner"></span> Creating... } @else { Register }
            </button>
          </div>
        </form>
        }
      </div>
      }

    </div>
  </main>

  <aside class="visual-panel">
    <div class="visual-content">
      <div class="text-content">
        <h2>Your Digital Guardian</h2>
        <p>Advanced video privacy and GDPR compliance, powered by state-of-the-art technology. OccultaShield stands
          watch, so you don't have to.</p>
      </div>
    </div>
  </aside>
</div>